<!--
	作者：444811716@qq.com
	时间：2016-11-24
	描述：创建人员资料
-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>创建人员资料</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<style>
			body,
			.mui-content {
				background: white;
			}

			.mui-scroll-wrapper {
				margin-top: 95px;
			}

			.mui-content>.mui-table-view:first-child {
				margin-top: 0px
			}

			.mui-table-view:after {
				height: 0px;
			}

			.mui-table-view-cell {
				padding: 5px 15px;
				line-height: 21px;
			}

			.mui-table-view-cell.mui-active {
				background: white;
			}

			#type .mui-table-view-cell {
				margin-top: 1px;
			}

			#type {
				border-bottom: 1px solid #dedfe0;
			}

			#type .mui-table-view-cell div,
			#type .mui-table-view-cell a {
				display: inline;
			}

			#type .mui-table-view-cell a {
				margin-left: 13%;
			}

			#type .mui-table-view-cell a.mui-active {
				background-color: white;
			}

			#type_name {
				height: 40px;
				padding-left: 0px;
				line-height: 40px;
				font-size: 15px;
				color: #323232;
			}

			#arrowdown {
				line-height: 40px;
			}

			.mui-input-row label {
				width: 25%;
				padding: 0px;
				height: 40px;
				line-height: 40px;
				font-size: 15px;
				color: #323232;
			}

			.mui-input-row label~input {
				width: 75%;
				font-size: 15px;
				padding-right: 30px;
			}

			.mui-checkbox input[type=checkbox]:before {
				font-size: 25px;
			}

			.mui-icon-arrowdown {
				color: #B7B7B7;
			}

			.mui-backdrop {
				/*选择排序的遮罩*/
				/*position: fixed;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
				z-index: 0;*/
				background-color: transparent;
				/*height: 0px;
				width: 0px;*/
			}

			.mui-popover .mui-popover-arrow:after {
				/*popover的三角形箭头*/
				background-color: white;
				box-shadow: 0 0 5px rgba(0, 0, 0, .1);
			}

			.mui-checkbox input[type=checkbox]:checked:before,
			.mui-radio input[type=radio]:checked:before {
				color: #1DB8F1;
				font-size: 25px;
			}

			#stu_create .mui-table-view:before,
			#tea_create .mui-table-view:before {
				height: 0px;
			}

			#stu_create .mui-table-view-cell:last-child:after,
			#tea_create .mui-table-view-cell:last-child:after {
				height: 1px;
			}

			input[type=text],
			input[type=tel] {
				font-size: 15px;
				line-height: 40px;
				color: #666666;
			}

			.text-color-disabled,
			.text-color-disabled .mui-input-row label,
			.text-color-disabled .mui-input-row label~input {
				color: #CCCCCC;
			}

			.mui-input-row .mui-input-clear~.mui-icon-clear {
				/*删除按钮*/
				color: #e4e4e4;
			}

			input::-webkit-input-placeholder {
				color: #999999;
				font-size: 15px;
				/* WebKit browsers */
			}

			input:-moz-placeholder {
				color: #999999;
				font-size: 15px;
				/* Mozilla Firefox 4 to 18 */
			}

			input::-moz-placeholder {
				color: #999999;
				font-size: 15px;
				/* Mozilla Firefox 19+ */
			}

			input:-ms-input-placeholder {
				color: #999999;
				font-size: 15px;
				/* Internet Explorer 10+ */
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="color: white;">创建资料</h1>
			<div id="finish" class="title-text-pull-right">完成</div>
		</header>

		<div id="content" class="mui-content">
			<ul id="type" class="mui-table-view">
				<li class="mui-table-view-cell">
					<div id="type_name_la">身份:</div>
					<a href="#popover" id="type_name">
						<div class="mui-input-row mui-checkbox mui-left" style="display: inline;">
							<label id="type_name_font" style="padding-left: 40px;width: initial;padding-top: 3px;">学生</label>
							<input id="type_cb" name="checkbox1" type="checkbox" checked style="top: -5px;left: 1px;">
						</div>
						<div id="arrowdown" class="mui-icon mui-icon-arrowdown"></div>
					</a>
				</li>
			</ul>
			<div id="stu_create" class="mui-scroll-wrapper" style="display:inline ;">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="padding-right: 25px;">
							<div style="position: absolute;right: 15px;top: 20px;color: red;font-size: 24px;">*</div>
							<div class="mui-input-row">
								<label id="stu_la">学生姓名:</label>
								<input id="stu_name" type="text" class="mui-input-clear" maxlength="10" placeholder="姓名最多10个字">
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>学生账号:</label>
								<input id="stu_utid" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>学生电话:</label>
								<input type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row ">
								<label>性别:</label>
								<input id="stu_gender" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div id="tea_create" class="mui-scroll-wrapper" style="display:none ;">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="padding-right: 25px;">
							<div style="position: absolute;right: 15px;top: 20px;color: red;font-size: 24px;">*</div>
							<div class="mui-input-row">
								<label>姓名:</label>
								<input id="tea_name" type="text" class="mui-input-clear" maxlength="10" placeholder="姓名最多10个字">
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>账号:</label>
								<input id="tea_utid" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>手机号:</label>
								<input id="tea_phone" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell text-color-disabled">
							<div class="mui-input-row">
								<label>性别:</label>
								<input id="tea_gender" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职位:</label>
								<input id="tea_job" type="text" class="mui-input-clear" maxlength="10" placeholder="职位最多10个字">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>科目:</label>
								<input id="tea_sub" type="text" class="mui-input-clear" maxlength="10" placeholder="科目最多10个字">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职称:</label>
								<input id="tea_title" type="text" class="mui-input-clear" maxlength="10" placeholder="职称最多10个字">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>教龄:</label>
								<input id="tea_expsch" type="tel" class="mui-input-clear" maxlength="2" placeholder="教龄0-99">
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div id="popover" class="mui-popover" style="width: 110px;">
				<div id="popover_arrow" class="mui-popover-arrow"></div>
				<ul class="mui-table-view" style="background: white;text-align: center;">
					<li class="mui-table-view-cell" style="padding-left: 0px;padding-right: 0px;text-align: center;">
						<div class="mui-input-row mui-checkbox mui-left">
							<div id="type_popover" style="line-height: 40px; font-size: 15px;text-align: center;margin-left: 28px;margin-top: 1px;">老师</div>
							<input id="cb_popover" name="Checkbox2" type="checkbox" style="line-height: 40px;top: 0px;margin-top: 1px;">
						</div>
					</li>
				</ul>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<script type="text/javascript">
			mui.init();

			document.getElementById("stu_create").style.marginTop = (localStorage.getItem('StatusHeightNo') * 1 + 45 + 54) + 'px';
			document.getElementById("tea_create").style.marginTop = (localStorage.getItem('StatusHeightNo') * 1 + 45 + 54) + 'px';

			var mstype = 3; //创建的资料类型0家长,2老师,3学生
			var main; //获取当前窗体对象
			var mainData; //接收页面传入的参数值
			mui.plusReady(function() {
				initData();
				initListener();
				initScroll();
			});

			/**
			 * 初始化数据
			 */
			function initData() {
				events.blurBack();
				main = plus.webview.currentWebview(); //获取当前窗体对象
				mainData = main.data; //接收页面传入的参数值
				//var mainData = {
				//	gid: gid, //群id
				//	gname: gname, //群名称
				//}
				//console.log('从群资料页面获取的数据:' + JSON.stringify(mainData));
			}

			/**
			 * 初始化监听
			 */
			function initListener() {
				document.getElementById('type_popover').addEventListener('tap', function() {
					tapPopover();
				});

				document.getElementById('cb_popover').addEventListener('change', function() {
					document.getElementById("cb_popover").checked = false;
					tapPopover();
				});

				//监听教龄输入
				document.getElementById('tea_expsch').addEventListener('input', function() {
					//console.log('this ' + this.value + '|' + this.value.length);
					if(this.value.length > 2) {
						this.value = this.value.slice(0, 2)
					}
					var value = this.value;
					var temp = '';
					//console.log('value ' + value);
					for(var i = 0; i < value.length; i++) {
						if(value[i].replace(/^[1-9]\d*|0$/, '') == '') {
							//console.log('this.value ' + i + '|' + value[i]);
							temp = temp + value[i];
						}
					}
					this.value = temp;
				});
			}

			/**
			 * 初始化滚动
			 */
			function initScroll() {
				mui(".mui-scroll-wrapper").scroll({
					scrollY: true, //是否竖向滚动
					scrollX: false, //是否横向滚动
					indicators: true, //是否显示滚动条
					deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
					bounce: true, //是否启用回弹
				});
			}

			/**
			 * 点击popover的效果
			 */
			function tapPopover() {
				var value = document.getElementById("type_popover").innerText;
				if(value == '老师') {
					document.getElementById("type_popover").innerText = '学生';
					document.getElementById("type_name_font").innerText = '老师';
					document.getElementById("stu_create").style.display = 'none';
					document.getElementById("tea_create").style.display = 'inline';
					mstype = 2;
				} else {
					document.getElementById("type_popover").innerText = '老师';
					document.getElementById("type_name_font").innerText = '学生';
					document.getElementById("stu_create").style.display = 'inline';
					document.getElementById("tea_create").style.display = 'none';
					mstype = 3;
				}
				mui('#popover').popover('hide');
			}

			//完成按钮监听
			document.getElementById('finish').addEventListener('tap', function() {
				var name = ''; //姓名
				var job = '0'; //职位，老师用,其他填0
				var title = '0'; //职称，老师用,其他填0
				var expsch = '0'; //教龄，老师用,其他填0
				var sub = '0'; //科目，老师用,其他填0

				if(mstype == 3) { //资料类型0家长,2老师,3学生
					name = document.getElementById("stu_name").value;
				} else if(mstype == 2) {
					name = document.getElementById("tea_name").value;
					job = document.getElementById("tea_job").value;
					title = document.getElementById("tea_title").value;
					expsch = document.getElementById("tea_expsch").value;
					sub = document.getElementById("tea_sub").value;
				}
				if(name.replace(/(^\s*)|(\s*$)/g, "") == "") { //为空不允许发送
					mui.toast('姓名不允许为空');
				} else if(name.length > 10) {
					mui.toast('姓名,最多10个字');
				} else {
					if(mstype == 3) {
						addData(name, job, title, expsch, sub);
					} else if(mstype == 2) {
						if(job.length > 10) {
							mui.toast('职位最多10个字');
						} else if(sub.length > 10) {
							mui.toast('科目最多10个字');
						} else if(title.length > 10) {
							mui.toast('职称最多10个字');
						} else if(expsch > 99 || expsch < 0) {
							mui.toast('教龄0-99');
						} else {
							addData(name, job, title, expsch, sub);
						}
					}

				}
			});

			function addData(name, job, title, expsch, sub) {
				//15.用户添加资料
				//所需参数
				var comData = {
					gid: mainData.gid, //群ID
					stuname: name, //资料名
					stuimg: '', //资料头像
					mstype: mstype, //资料类型，0家长,2老师,3学生
					job: job, //职位，老师用,其他填0
					title: title, //职称，老师用,其他填0
					expsch: expsch, //教龄，老师用,其他填0
					sub: sub, //科目，老师用,其他填0
					gutid: '0' //关联的群账号ID，用户在群里的账号ID,无则为0
				};
				//console.log('comData:' + JSON.stringify(comData));
				// 等待的对话框
				var wd = events.showWaiting();
				postDataPro_PostGAddUInf(comData, wd, function(data) {

					//console.log('90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
					if(data.RspCode == 0) {
						mui.toast('资料添加成功！');
						//console.log('资料添加成功！');
						events.fireToPageNone('qun_manage_a.html', 'addData', {
							stuid: data.RspData,
							gid: mainData.gid,
							stuname: name,
							stuimg: '',
							mstype: mstype
						});
						if(mstype == 3) { //2老师,3学生
							document.getElementById("stu_name").value = '';
						} else {
							//console.log('老师');
							document.getElementById("tea_name").value = '';
							document.getElementById("tea_job").value = '';
							document.getElementById("tea_title").value = '';
							document.getElementById("tea_expsch").value = '';
							document.getElementById("tea_sub").value = '';
						}
					} else {
						mui.toast(data.RspTxt);
					}
					wd.close();
				});
			}
		</script>
	</body>

</html>